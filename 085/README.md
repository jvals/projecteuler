This problem was solved by pen&paper and a spreadsheet.

Page1 and Page2 shows how I arrived at a formula with two unknowns. This formula is rearranged using the quadratic formula to get n alone on the LHS.

The second column of the spreadsheet computes n using the previously discovered formula, where m is defined in the first column. The third column is TRUE if the value in the second column is an INT, otherwise FALSE. The fourth column contains the number of rectangles. I started this value at 2M and decreased it until I found a solution.
